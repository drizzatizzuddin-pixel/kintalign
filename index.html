<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plaque Score Generator (4x4 Grid Final)</title>
<style>
/* --- 1. Global Styles --- */
body { 
    font-family: Arial, sans-serif; 
    margin: 20px; 
    user-select: none; 
}
h2, #score { 
    text-align: center; 
}
#score {
    margin-top: 20px; 
    font-size: 18px; 
    font-weight: bold;
}

/* --- 2. Chart Layout & Centering --- */
.dental-chart-container {
    max-width: 900px;
    margin: 40px auto 0; /* Centering the container */
    display: grid;
    gap: 20px; 
    padding: 0 10px;
}
.arch {
    display: flex;
    justify-content: center;
}
.quadrant {
    display: flex; 
    padding: 0 5px; 
}
.quadrant.right {
    /* Q1 (Upper Right) and Q4 (Lower Right) must draw P-A (18 to 11, 48 to 41) */
    flex-direction: row-reverse;
}

/* --- 3. Tooth Styling (4x4 Grid) --- */
.tooth {
    position: relative;
    width: 64px; 
    height: 64px; 
    margin: 0 2px;
    box-sizing: border-box; 
    border: 1px solid black; /* Outer tooth border */
    cursor: pointer;
    
    /* 4x4 Grid Definition */
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr; 
    grid-template-rows: 1fr 1fr 1fr 1fr;
    background: white; 
}

/* --- 4. Surface Styling & Demarcation (Consistent Lines) --- */
.surface {
    position: relative;
    background: white;
    cursor: pointer;
    box-sizing: border-box;
    transition: background-color 0.1s;
    border: 0; 
    z-index: 2; 
}

/* --- POSTERIOR TEETH (5 Surfaces) Grid Assignment & Demarcation --- */

/* Mesial (M) - Full height column 1 */
.tooth.posterior .surface.M { 
    grid-area: 1 / 1 / 5 / 2;
    border-right: 1px solid black; 
} 

/* Distal (D) - Full height column 4 */
.tooth.posterior .surface.D { 
    grid-area: 1 / 4 / 5 / 5;
    border-left: 1px solid black; 
}

/* Buccal (B) - Row 1, Cols 2 & 3 */
.tooth.posterior .surface.B { 
    grid-area: 1 / 2 / 2 / 4; 
    border-bottom: 1px solid black; 
}

/* Occlusal (O) - Rows 2 & 3, Cols 2 & 3 */
.tooth.posterior .surface.O { 
    grid-area: 2 / 2 / 4 / 4; 
    border-bottom: 1px solid black; 
}

/* Lingual (L) - Row 4, Cols 2 & 3 */
.tooth.posterior .surface.L { 
    grid-area: 4 / 2 / 5 / 4;
}

/* --- ANTERIOR TEETH (4 Surfaces) Grid Assignment & Demarcation --- */

/* Mesial (M) - Full height column 1 */
.tooth.anterior .surface.M { 
    grid-area: 1 / 1 / 5 / 2;
    border-right: 1px solid black; 
} 

/* Distal (D) - Full height column 4 */
.tooth.anterior .surface.D { 
    grid-area: 1 / 4 / 5 / 5;
    border-left: 1px solid black; 
}

/* Buccal (B) - Rows 1 & 2, Cols 2 & 3 */
.tooth.anterior .surface.B { 
    grid-area: 1 / 2 / 3 / 4; 
    border-bottom: 1px solid black; 
}

/* Lingual (L) - Rows 3 & 4, Cols 2 & 3 */
.tooth.anterior .surface.L { 
    grid-area: 3 / 2 / 5 / 4;
}

/* --- 5. Plaque Marking & Missing Status --- */

.surface.plaque {
    background-color: #990099; /* Solid purple fill */
}

/* Missing Tooth Styling */
.tooth.missing {
    opacity: 0.5;
    pointer-events: none; 
}
.tooth.missing .surface {
    /* Set the background of the surface to gray when missing */
    background-color: #a9a9a9 !important;
}

/* --- 6. Numbering (Labels) --- */
.number-label {
    position: absolute;
    font-size: 10px;
    width: 100%;
    text-align: center;
    line-height: 1;
    font-weight: normal;
    z-index: 10;
}
.upper-arch .number-label { top: -15px; }
.lower-arch .number-label { bottom: -15px; }
</style>
</head>
<body>

<h2>Dental Plaque Chart (Click to Mark Plaque)</h2>

<div class="dental-chart-container">
    <div class="arch upper-arch">
        <div class="quadrant right" id="q1"></div>
        <div class="quadrant left" id="q2"></div>
    </div>
    <div class="arch lower-arch">
        <div class="quadrant right" id="q4"></div>
        <div class="quadrant left" id="q3"></div>
    </div>
</div>

<h3 id="score">Plaque Score: 0%</h3>

<div style="text-align: center; margin-top: 15px; font-size: 14px;">
    **Right-click** on a tooth to toggle its **Missing** status (and to undo it).
</div>

<script>
const toothData = {
    // Q1: Upper Right. Reversed to draw 18 (left) to 11 (right/center)
    'q1': [11, 12, 13, 14, 15, 16, 17, 18].reverse(), 
    // Q2: Upper Left. Draws 21 (left/center) to 28 (right)
    'q2': [21, 22, 23, 24, 25, 26, 27, 28],
    // Q3: Lower Left. Draws 31 (left/center) to 38 (right)
    'q3': [31, 32, 33, 34, 35, 36, 37, 38],
    // Q4: Lower Right. Reversed to draw 48 (left) to 41 (right/center)
    'q4': [41, 42, 43, 44, 45, 46, 47, 48].reverse() 
};

const posteriorTeeth = [14, 15, 16, 17, 18, 24, 25, 26, 27, 28, 34, 35, 36, 37, 38, 44, 45, 46, 47, 48];
const surfacesPost = ['M', 'D', 'B', 'L', 'O']; // 5 surfaces
const surfacesAnt = ['M', 'D', 'B', 'L'];      // 4 surfaces

let validSurfaces = 0; // The total number of non-missing surfaces used for the denominator

function isPosterior(tNum) {
    return posteriorTeeth.includes(tNum);
}

function getSurfacesForTooth(tNum) {
    return isPosterior(tNum) ? surfacesPost : surfacesAnt;
}

function generateChart() {
    const quadrants = document.querySelectorAll('.quadrant');

    quadrants.forEach(quad => {
        const teeth = toothData[quad.id];

        teeth.forEach(tNum => {
            const isPost = isPosterior(tNum);
            const surfaces = getSurfacesForTooth(tNum);
            
            const toothDiv = document.createElement('div');
            toothDiv.className = `tooth ${isPost ? 'posterior' : 'anterior'}`;
            toothDiv.id = `t${tNum}`;
            
            // 1. Add Tooth Number Label
            const numLabel = document.createElement('span');
            numLabel.className = 'number-label';
            numLabel.textContent = tNum;
            toothDiv.appendChild(numLabel);

            // 2. Add Clickable Surfaces
            surfaces.forEach(key => {
                const surfaceDiv = document.createElement('div');
                surfaceDiv.className = `surface ${key}`;
                surfaceDiv.id = `${tNum}-${key}`;
                surfaceDiv.onclick = () => toggleSurface(`${tNum}-${key}`);
                toothDiv.appendChild(surfaceDiv);
            });

            // 3. Add event listeners
            toothDiv.oncontextmenu = (e) => {
                e.preventDefault(); 
                toggleMissing(tNum);
            };

            // 4. Update initial valid surfaces count
            validSurfaces += surfaces.length;
            quad.appendChild(toothDiv);
        });
    });
    updateScore();
}

function updateScore() {
    // Recalculate surfaces with plaque by counting the elements currently marked
    const surfacesWithPlaque = document.querySelectorAll('.surface.plaque').length;
    
    // Calculation: Total Plaque / (Total Possible Surfaces - Surfaces of Missing Teeth)
    let percent = validSurfaces === 0 ? 0 : Math.round((surfacesWithPlaque / validSurfaces) * 100);
    document.getElementById('score').innerText = `Plaque Score: ${percent}%`;
}

function toggleSurface(id) {
    const elem = document.getElementById(id);
    const toothDiv = elem.closest('.tooth');

    if (toothDiv.classList.contains('missing')) return;

    // Toggle plaque class
    elem.classList.toggle('plaque');
    
    // Update score immediately
    updateScore();
}

function toggleMissing(toothNum) {
    const toothDiv = document.getElementById(`t${toothNum}`);
    const surfaceCount = getSurfacesForTooth(toothNum).length;
    
    if (toothDiv.classList.contains('missing')) {
        // --- RESTORE tooth (undo missing) ---
        toothDiv.classList.remove('missing');
        validSurfaces += surfaceCount; 
        
    } else {
        // --- MARK AS MISSING ---
        const surfaces = toothDiv.querySelectorAll('.surface');
        
        // 1. Clear any existing plaque on this tooth
        surfaces.forEach(s => {
            s.classList.remove('plaque');
        });
        
        // 2. Mark the tooth as missing
        toothDiv.classList.add('missing');
        
        // 3. Subtract the count of surfaces from the valid total
        validSurfaces -= surfaceCount; 
    }
    
    // Update score immediately after changing validSurfaces and cleaning up plaque
    updateScore();
}

generateChart();
</script>
</body>
</html>
